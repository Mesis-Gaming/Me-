local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local settings = {
    corpseESP = {
        enabled = false,
        textColor = Color3.fromRGB(255, 0, 0),
        outlineColor = Color3.fromRGB(0, 0, 0),
        unionColor = Color3.fromRGB(205, 205, 205)
    },
    atvESP = {
        enabled = false,
        textColor = Color3.fromRGB(0, 255, 0),
        outlineColor = Color3.fromRGB(0, 0, 0)
    }
}

local CorpseCaches, ATVCache = {}, {}

workspace.ChildAdded:Connect(function(child)
    if settings.corpseESP.enabled then
        local unionOp = child:FindFirstChildOfClass("UnionOperation")
        if unionOp and unionOp.Color == settings.corpseESP.unionColor then
            local corpseCache = Drawing.new("Text")
            corpseCache.Size = 10
            corpseCache.Color = settings.corpseESP.textColor
            corpseCache.Outline = true
            corpseCache.OutlineColor = settings.corpseESP.outlineColor
            CorpseCaches[child] = corpseCache
        end
    end
end)

workspace.ChildRemoved:Connect(function(child)
    local corpseCache = CorpseCaches[child]
    if corpseCache then
        corpseCache:Remove()
        CorpseCaches[child] = nil
    end
end)

workspace.ChildAdded:Connect(function(child)
    if settings.atvESP.enabled then
        local seat = child:FindFirstChild("Seat")
        local plastics = child:FindFirstChild("Plastics")
        if seat and plastics then
            local atvHighlight = Drawing.new("Text")
            atvHighlight.Size = 10
            atvHighlight.Color = settings.atvESP.textColor
            atvHighlight.Outline = true
            atvHighlight.OutlineColor = settings.atvESP.outlineColor
            ATVCache[child] = atvHighlight
        end
    end
end)

workspace.ChildRemoved:Connect(function(child)
    local atvHighlight = ATVCache[child]
    if atvHighlight then
        atvHighlight:Remove()
        ATVCache[child] = nil
    end
end)

RunService.Heartbeat:Connect(function()
    if settings.corpseESP.enabled then
        for corpse, corpseCache in pairs(CorpseCaches) do
            local primaryPart = corpse.PrimaryPart
            if primaryPart then
                local screenPos, onScreen = Camera:WorldToViewportPoint(primaryPart.Position)
                local distance = (Camera.CFrame.Position - primaryPart.Position).Magnitude
                corpseCache.Visible = onScreen
                if corpseCache.Visible then
                    corpseCache.Text = "Corpse [" .. math.floor(distance) .. "]"
                    corpseCache.Position = Vector2.new(screenPos.X, screenPos.Y)
                end
            end
        end
    end

    if settings.atvESP.enabled then
        for atv, atvHighlight in pairs(ATVCache) do
            local primaryPart = atv.PrimaryPart
            if primaryPart then
                local screenPos, onScreen = Camera:WorldToViewportPoint(primaryPart.Position)
                local distance = (Camera.CFrame.Position - primaryPart.Position).Magnitude
                atvHighlight.Visible = onScreen
                if atvHighlight.Visible then
                    atvHighlight.Text = "ATV [" .. math.floor(distance) .. "]"
                    atvHighlight.Position = Vector2.new(screenPos.X, screenPos.Y)
                end
            end
        end
    end
end)

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.V then
        settings.corpseESP.enabled = not settings.corpseESP.enabled
        print("Corpse ESP is now " .. (settings.corpseESP.enabled and "enabled" or "disabled"))
    elseif input.KeyCode == Enum.KeyCode.O then
        settings.atvESP.enabled = not settings.atvESP.enabled
        print("ATV ESP is now " .. (settings.atvESP.enabled and "enabled" or "disabled"))
    end
end)
